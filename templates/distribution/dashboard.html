{% extends "base.html" %}
{% load i18n %}

{% block title %}
     {{ food_network_name }} {% trans "Distribution System" %}
{% endblock %}

{% block extra_head %}
{{ block.super }}

{% include "dojo_include.html" %}

    <script type="text/javascript">
        dojo.require("dojo.parser");
        dojo.require("dijit.form.DateTextBox");
    </script>

{% endblock %}

{% block header %}

<script type="text/javascript" >
	dojo.addOnLoad(function()
	{
		dojo.byId("id_current_week").focus();
	});

</script>

{% endblock %}

{% block content %}

<div class="dashboard">

	{% include "distribution/tabnav.html" %}

	<div  style="margin-left: 1em;" .

	{% if food_network_name %}

	<h2><strong>{{ food_network_name }} {% trans "Distribution System" %}</strong></h2>

		{% comment %}
		{% if user.is_authenticated %}
			<div style="margin-bottom: 1em; " >
				<form style="display: inline; " action="{% url send_fresh_list %}" method="POST">{% csrf_token %}
					<input class="submit-btn" type="submit" value="{% trans 'Send Availability Emails' %}" />
					<input type="hidden" name="next" value="{% url dashboard %}" />
				</form>	
				<form style="display: inline; " action="{% url send_pickup_list %}" method="POST">{% csrf_token %}
					<input class="submit-btn" type="submit" value="{% trans 'Send Pickup List Emails' %}" />
					<input type="hidden" name="next" value="{% url dashboard %}" />
				</form>
				<form style="display: inline; " action="{% url send_delivery_list %}" method="POST">{% csrf_token %}
					<input class="submit-btn" type="submit" value="{% trans 'Send Delivery List Emails' %}" />
					<input type="hidden" name="next" value="{% url dashboard %}" />
				</form>
				<form style="display: inline; " action="{% url send_order_notices %}" method="POST">{% csrf_token %}
					<input class="submit-btn" type="submit" value="{% trans 'Send Order Emails' %}" />
					<input type="hidden" name="next" value="{% url dashboard %}" />
				</form>
				
			</div>
		{% endif %}
		{% endcomment %}

		<h4 style="margin-bottom: 4px;" >
			Week of 
			{% if user.is_authenticated %}
				<form style="display: inline;" action="{% url reset_week %}" method="POST">{% csrf_token %}
					{{ week_form.current_week }}
					<input class="submit-btn" type="submit" value="{% trans 'Reset' %}" />
				</form>
			{% else %}
				{{ order_date }}
			{% endif %}
		</h4>
		{% if shorts %}
		<div style="float:left; padding: 1em;">
			<h4 style="margin-bottom: 0;" >{{ shorts_label }}:</h4>
			<table class="ga-event-table" style="font-size: 80%; margin-top: 0;" >
				<tr>
					<th>{% trans "Product" %}</th>
					<th>{% trans "Available" %}</th>
					<th>{% trans "Ordered" %}</th>
					<th>{% trans "Short" %}</th>
					<th>{% trans "Orders" %}</th>
				</tr>
				{% for short in shorts %}
				<tr>
					<td>{{ short.product }}</td>
					<td style="text-align: right;">{{ short.total_avail }}</td>
					<td style="text-align: right;">{{ short.total_ordered }}</td>
					<td style="text-align: right;">{{ short.quantity_short }}</td>
					<td>
						{% for oi in short.order_items %}
						{{ oi.order.delivery_date|date:"n-d" }} {{ oi.order.customer }} {{ oi.quantity }}</br>
						{% endfor %}
					</td>
				</tr>
				{% endfor %}

			</table>
		</div>
		{% endif %}

		{% if orders %}
		<div style="float:left; padding: 1em;">
			<h4 style="margin-bottom: 0;" >Orders:</h4>
			<table class="ga-event-table" style="font-size: 80%; margin-top: 0;" >
				<tr>
					<th>{% trans "Customer" %}</th>
					<th>{% trans "Delivery Date" %}</th>
					<th>{% trans "Items" %}</th>
					<th>{% trans "Total" %}</th>
				</tr>
				{% for order in orders %}
				<tr>
					<td>{{ order.customer }}</td>
					<td>{{ order.delivery_date|date:"n-d" }}</td>
					<td>
						{% for oi in order.orderitem_set.all %}
						{{ oi.product }} {{ oi.quantity }}</br>
						{% endfor %}
					</td>
					<td style="text-align: right;" >${{ order.grand_total }}</td>
				</tr>
				{% endfor %}

			</table>
		</div>
		{% endif %}

		{% if shorts %}
			{% if orders %}
			<div style="clear:both;"></div>
			{% endif %}
		{% endif %}

		{% if items %}
		<div style="float:left; padding: 1em;">
			<h4 style="margin-bottom: 0;" >Inventory:</h4>
			<table class="ga-event-table" style="font-size: 80%; margin-top: 0;" >
				<tr>
					<th>{% trans "Category" %}</th>
					<th>{% trans "Product" %}</th>
					<th>{% trans "Method" %}</th>
					<th>{% trans "Producer" %}</th>
					<th>{% trans "Avail" %}</th>
				</tr>
				{% for item in items %}
				<tr>
					<td>{{ item.category }}</td>
					<td>{{ item.product.long_name }}</td>
					<td>{{ item.product.growing_method }}</td>
					<td>{{ item.producer }}</td>
					<td style="text-align: right;">{{ item.avail_qty }}</td>
				</tr>
				{% endfor %}

			</table>
		</div>
		{% endif %}

		{% if plans %}
		<div style="float:left; padding: 1em;">
			<h4 style="margin-bottom: 0;" >Production plans:</h4>
			<table class="ga-event-table" style="font-size: 80%; margin-top: 0;" >
				<tr>
					<th>{% trans "Category" %}</th>
					<th>{% trans "Product" %}</th>
					<th>{% trans "Method" %}</th>
					<th>{% trans "Producer" %}</th>
					<th>{% trans "Qty" %}</th>
				</tr>
				{% for plan in plans %}
				<tr>
					<td>{{ plan.category }}</td>
					<td>{{ plan.product.long_name }}</td>
					<td>{{ plan.product.growing_method }}</td>
					<td>{{ plan.member }}</td>
					<td style="text-align: right;">{{ plan.quantity }}</td>
				</tr>
				{% endfor %}

			</table>
		</div>
		{% endif %}

	{% else %}

		<h3>{% trans "You must create a Food Network in Admin to proceed" %}</h3>
	
	{% endif %}
	</div>
	<div style="clear:both;"></div>

</div>
{% endblock %} 

